(function(e){function a(){var a=_[d];0==d&&e(".geo-ip-update-wrapper").fadeIn(p).css("display","table"),a&&(t(a),i(a),d++)}function t(t){if(t&&t.action){var i={action:t.action};t.parameters&&"object"==typeof t.parameters&&i.push(t.parameters),e.ajax({url:ajaxurl,method:"POST",data:i,success:function(t){console.log(t),t.success?(a(),t.date&&t.string_date&&(e(".time-ago").data("timeago",null).attr("datetime",t.date).text(t.string_date).timeago(),e(".update").attr("diff",0),o()),t.size&&e(".geo-ip-size").text(t.size)):n(t.exception)}})}return!1}function i(a){e(a.class).siblings(":visible").length>0?e(a.class).siblings(":visible").css("transform","translate3d(0, "+l+", 0)").fadeOut(c,function(){a.finish&&e(".geo-ip-update-wrapper .animation").fadeOut(c/2).css("transform","translate3d(0, -"+l+", 0)"),e(a.class).fadeIn(c).css("transform","translate3d(0, 0px, 0)")}):(a.finish&&e(".geo-ip-update-wrapper .animation").fadeOut(c/2).css("transform","translate3d(0, -"+l+", 0)"),e(a.class).fadeIn(c).css("transform","translate3d(0, 0px, 0)"))}function s(){d=0,e(".geo-ip-update-wrapper .animation, .geo-ip-update-wrapper .process > div, .bookshelf_wrapper").removeAttr("style"),e(".bookshelf_wrapper").removeClass("paused")}function n(a){e(".bookshelf_wrapper").addClass("paused"),e(".process .failure").siblings(":visible").css("transform","translate3d(0, "+l+", 0)").fadeOut(c,function(){console.log(f[a]),e(".process .failure .exception").text(f[a]),e(".process .failure").fadeIn(c).css("transform","translate3d(0, 0px, 0)")})}function o(){var t=e(".update").attr("diff"),i=e(".time-ago").text()==i10n_geo_ip.NEVER;if(""==t||t>=r||i)e(".update").on("click",function(){return a()});else{var s=r-t,n=1==s?i10n_geo_ip.HOUR:i10n_geo_ip.HOURS,o=i10n_geo_ip.UPDATE_AVAILABLE_IN.replace("%d",s).replace("%s",n);e(".update").after('<span class="remain">[ '+o+" ]</span>").remove()}}var r=72,p=250,c=400,l="40px",d=0,_=[{action:"geo_ip_get_library",class:".downloading"},{action:"geo_ip_extract_library",class:".decompressing"},{action:"geo_ip_update_latest",class:".done",finish:!0}],f={FILE_DOWNLOAD:i10n_geo_ip.EX_FILE_EXTRACTION,FILE_SIZE:i10n_geo_ip.EX_FILE_SIZE,FILE_EXTRACTION:i10n_geo_ip.EX_FILE_EXTRACTION,FILE_NOT_FOUND:i10n_geo_ip.EX_FILE_NOT_FOUND};e(document).ready(function(){o(),e(".time-ago").text()!=i10n_geo_ip.NEVER&&e(".time-ago").timeago(),e(".geo-ip-close").on("click",function(){return e(".geo-ip-update-wrapper").fadeOut(p,function(){s()}),!1})})})(jQuery);