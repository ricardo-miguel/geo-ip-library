(function(e){function a(){var a=_[d];0==d&&e(".geo-ip-update-wrapper").fadeIn(p).css("display","table"),a&&(t(a),s(a),d++)}function t(t){if(t&&t.action){var s={action:t.action};t.parameters&&"object"==typeof t.parameters&&s.push(t.parameters),e.ajax({url:ajaxurl,method:"POST",data:s,success:function(t){console.log(t),t.success?(a(),t.date&&t.string_date&&(e(".time-ago").data("timeago",null).attr("datetime",t.date).text(t.string_date).timeago(),e(".update").attr("diff",0),o()),t.size&&e(".geo-ip-size").text(t.size)):n(t.exception)}})}return!1}function s(a){e(a.class).siblings(":visible").length>0?e(a.class).siblings(":visible").css("transform","translate3d(0, "+c+", 0)").fadeOut(l,function(){a.finish&&e(".geo-ip-update-wrapper .animation").fadeOut(l/2).css("transform","translate3d(0, -"+c+", 0)"),e(a.class).fadeIn(l).css("transform","translate3d(0, 0px, 0)")}):(a.finish&&e(".geo-ip-update-wrapper .animation").fadeOut(l/2).css("transform","translate3d(0, -"+c+", 0)"),e(a.class).fadeIn(l).css("transform","translate3d(0, 0px, 0)"))}function i(){d=0,e(".geo-ip-update-wrapper .animation, .geo-ip-update-wrapper .process > div, .bookshelf_wrapper").removeAttr("style"),e(".bookshelf_wrapper").removeClass("paused")}function n(a){e(".bookshelf_wrapper").addClass("paused"),e(".process .failure").siblings(":visible").css("transform","translate3d(0, "+c+", 0)").fadeOut(l,function(){console.log(f[a]),e(".process .failure .exception").text(f[a]),e(".process .failure").fadeIn(l).css("transform","translate3d(0, 0px, 0)")})}function o(){var t=e(".update").attr("diff"),s=e(".time-ago").text()==l10n_geo_ip.NEVER;if(""==t||t>=r||s)e(".update").on("click",function(){return a()});else{var i=r-t,n=1==i?l10n_geo_ip.HOUR:l10n_geo_ip.HOURS,o=l10n_geo_ip.UPDATE_AVAILABLE_IN.replace("%d",i).replace("%s",n);e(".update").after('<span class="remain">[ '+o+" ]</span>").remove()}}var r=72,p=250,l=400,c="40px",d=0,_=[{action:"geo_ip_get_library",class:".downloading"},{action:"geo_ip_extract_library",class:".decompressing"},{action:"geo_ip_update_latest",class:".done",finish:!0}],f={FILE_DOWNLOAD:l10n_geo_ip.EX_FILE_EXTRACTION,FILE_SIZE:l10n_geo_ip.EX_FILE_SIZE,FILE_EXTRACTION:l10n_geo_ip.EX_FILE_EXTRACTION,FILE_NOT_FOUND:l10n_geo_ip.EX_FILE_NOT_FOUND};e(document).ready(function(){o(),e(".time-ago").text()!=l10n_geo_ip.NEVER&&e(".time-ago").timeago(),e(".geo-ip-close").on("click",function(){return e(".geo-ip-update-wrapper").fadeOut(p,function(){i()}),!1})})})(jQuery);